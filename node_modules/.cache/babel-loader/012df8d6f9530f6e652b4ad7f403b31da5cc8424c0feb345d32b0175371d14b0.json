{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { addDays, format, startOfMonth, endOfMonth } from 'date-fns';\nconst STORAGE_KEY = 'budget-tracker-data';\n\n// Helper function to safely handle date serialization\nconst dateReviver = (key, value) => {\n  if (key === 'date' && typeof value === 'string') {\n    return new Date(value);\n  }\n  return value;\n};\nexport const useFinancialData = currentDate => {\n  _s();\n  const [entries, setEntries] = useState([]);\n  const [monthData, setMonthData] = useState({\n    days: {},\n    totalIncome: 0,\n    totalExpenses: 0,\n    monthlyBalance: 0\n  });\n\n  // Load entries from localStorage on initial render\n  useEffect(() => {\n    try {\n      const storedData = localStorage.getItem(STORAGE_KEY);\n      if (storedData) {\n        const parsedData = JSON.parse(storedData, dateReviver);\n        setEntries(Array.isArray(parsedData) ? parsedData : []);\n      }\n    } catch (error) {\n      console.error('Error loading data from localStorage', error);\n      // Initialize with empty array if there's an error\n      setEntries([]);\n    }\n  }, []);\n\n  // Save entries to localStorage whenever they change\n  useEffect(() => {\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries, (key, value) => {\n        // Convert Date objects to ISO strings for storage\n        if (value instanceof Date) {\n          return value.toISOString();\n        }\n        return value;\n      }));\n    } catch (error) {\n      console.error('Error saving data to localStorage', error);\n    }\n  }, [entries]);\n\n  // Update month data whenever entries or current date change\n  useEffect(() => {\n    try {\n      const monthStart = startOfMonth(currentDate);\n      const monthEnd = endOfMonth(currentDate);\n      const daysInMonth = {};\n\n      // Initialize days in month\n      let day = monthStart;\n      while (day <= monthEnd) {\n        const dayStr = format(day, 'yyyy-MM-dd');\n        daysInMonth[dayStr] = {\n          date: new Date(day),\n          entries: [],\n          totalIncome: 0,\n          totalExpenses: 0,\n          dailyBalance: 0,\n          runningBalance: 0\n        };\n        day = addDays(day, 1);\n      }\n\n      // Add entries to their respective days\n      let monthlyIncome = 0;\n      let monthlyExpenses = 0;\n      entries.forEach(entry => {\n        // Ensure entry.date is a Date object\n        const entryDate = entry.date instanceof Date ? entry.date : new Date(entry.date);\n\n        // Only process entries for the current month\n        if (entryDate >= monthStart && entryDate <= monthEnd) {\n          const dayStr = format(entryDate, 'yyyy-MM-dd');\n          if (daysInMonth[dayStr]) {\n            daysInMonth[dayStr].entries.push({\n              ...entry,\n              date: entryDate // Ensure we use the Date object\n            });\n            if (entry.type === 'income') {\n              daysInMonth[dayStr].totalIncome += entry.amount;\n              monthlyIncome += entry.amount;\n            } else {\n              daysInMonth[dayStr].totalExpenses += entry.amount;\n              monthlyExpenses += entry.amount;\n            }\n            daysInMonth[dayStr].dailyBalance = daysInMonth[dayStr].totalIncome - daysInMonth[dayStr].totalExpenses;\n          }\n        }\n      });\n\n      // Calculate running balance for each day\n      let runningBalance = 0;\n      day = monthStart;\n      while (day <= monthEnd) {\n        const dayStr = format(day, 'yyyy-MM-dd');\n        runningBalance += daysInMonth[dayStr].dailyBalance;\n        daysInMonth[dayStr].runningBalance = runningBalance;\n        day = addDays(day, 1);\n      }\n      setMonthData({\n        days: daysInMonth,\n        totalIncome: monthlyIncome,\n        totalExpenses: monthlyExpenses,\n        monthlyBalance: monthlyIncome - monthlyExpenses\n      });\n    } catch (error) {\n      console.error('Error updating month data', error);\n      // Initialize with empty data if there's an error\n      setMonthData({\n        days: {},\n        totalIncome: 0,\n        totalExpenses: 0,\n        monthlyBalance: 0\n      });\n    }\n  }, [entries, currentDate]);\n  const addEntry = entry => {\n    try {\n      const newEntry = {\n        ...entry,\n        id: Date.now().toString(),\n        date: entry.date instanceof Date ? entry.date : new Date(entry.date)\n      };\n      setEntries(prev => [...prev, newEntry]);\n    } catch (error) {\n      console.error('Error adding entry', error);\n    }\n  };\n  const deleteEntry = id => {\n    setEntries(prev => prev.filter(entry => entry.id !== id));\n  };\n  return {\n    monthData,\n    addEntry,\n    deleteEntry,\n    entries\n  };\n};\n_s(useFinancialData, \"unfTMqhEPCNSBuklhiAo91L0StY=\");","map":{"version":3,"names":["useState","useEffect","addDays","format","startOfMonth","endOfMonth","STORAGE_KEY","dateReviver","key","value","Date","useFinancialData","currentDate","_s","entries","setEntries","monthData","setMonthData","days","totalIncome","totalExpenses","monthlyBalance","storedData","localStorage","getItem","parsedData","JSON","parse","Array","isArray","error","console","setItem","stringify","toISOString","monthStart","monthEnd","daysInMonth","day","dayStr","date","dailyBalance","runningBalance","monthlyIncome","monthlyExpenses","forEach","entry","entryDate","push","type","amount","addEntry","newEntry","id","now","toString","prev","deleteEntry","filter"],"sources":["C:/Users/Administrator/Documents/XDA/personal-budget-tracker/src/hooks/useFinancialData.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { addDays, format, startOfMonth, endOfMonth, getDate, isSameDay, parseISO } from 'date-fns';\r\nimport { FinancialEntry, DayData, MonthData } from '../types';\r\n\r\nconst STORAGE_KEY = 'budget-tracker-data';\r\n\r\n// Helper function to safely handle date serialization\r\nconst dateReviver = (key: string, value: any) => {\r\n  if (key === 'date' && typeof value === 'string') {\r\n    return new Date(value);\r\n  }\r\n  return value;\r\n};\r\n\r\nexport const useFinancialData = (currentDate: Date) => {\r\n  const [entries, setEntries] = useState<FinancialEntry[]>([]);\r\n  const [monthData, setMonthData] = useState<MonthData>({\r\n    days: {},\r\n    totalIncome: 0,\r\n    totalExpenses: 0,\r\n    monthlyBalance: 0,\r\n  });\r\n\r\n  // Load entries from localStorage on initial render\r\n  useEffect(() => {\r\n    try {\r\n      const storedData = localStorage.getItem(STORAGE_KEY);\r\n      if (storedData) {\r\n        const parsedData = JSON.parse(storedData, dateReviver);\r\n        setEntries(Array.isArray(parsedData) ? parsedData : []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading data from localStorage', error);\r\n      // Initialize with empty array if there's an error\r\n      setEntries([]);\r\n    }\r\n  }, []);\r\n\r\n  // Save entries to localStorage whenever they change\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries, (key, value) => {\r\n        // Convert Date objects to ISO strings for storage\r\n        if (value instanceof Date) {\r\n          return value.toISOString();\r\n        }\r\n        return value;\r\n      }));\r\n    } catch (error) {\r\n      console.error('Error saving data to localStorage', error);\r\n    }\r\n  }, [entries]);\r\n\r\n  // Update month data whenever entries or current date change\r\n  useEffect(() => {\r\n    try {\r\n      const monthStart = startOfMonth(currentDate);\r\n      const monthEnd = endOfMonth(currentDate);\r\n      const daysInMonth: Record<string, DayData> = {};\r\n      \r\n      // Initialize days in month\r\n      let day = monthStart;\r\n      while (day <= monthEnd) {\r\n        const dayStr = format(day, 'yyyy-MM-dd');\r\n        daysInMonth[dayStr] = {\r\n          date: new Date(day),\r\n          entries: [],\r\n          totalIncome: 0,\r\n          totalExpenses: 0,\r\n          dailyBalance: 0,\r\n          runningBalance: 0\r\n        };\r\n        day = addDays(day, 1);\r\n      }\r\n      \r\n      // Add entries to their respective days\r\n      let monthlyIncome = 0;\r\n      let monthlyExpenses = 0;\r\n      \r\n      entries.forEach(entry => {\r\n        // Ensure entry.date is a Date object\r\n        const entryDate = entry.date instanceof Date ? entry.date : new Date(entry.date);\r\n        \r\n        // Only process entries for the current month\r\n        if (entryDate >= monthStart && entryDate <= monthEnd) {\r\n          const dayStr = format(entryDate, 'yyyy-MM-dd');\r\n          \r\n          if (daysInMonth[dayStr]) {\r\n            daysInMonth[dayStr].entries.push({\r\n              ...entry,\r\n              date: entryDate // Ensure we use the Date object\r\n            });\r\n            \r\n            if (entry.type === 'income') {\r\n              daysInMonth[dayStr].totalIncome += entry.amount;\r\n              monthlyIncome += entry.amount;\r\n            } else {\r\n              daysInMonth[dayStr].totalExpenses += entry.amount;\r\n              monthlyExpenses += entry.amount;\r\n            }\r\n            \r\n            daysInMonth[dayStr].dailyBalance = daysInMonth[dayStr].totalIncome - daysInMonth[dayStr].totalExpenses;\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Calculate running balance for each day\r\n      let runningBalance = 0;\r\n      day = monthStart;\r\n      while (day <= monthEnd) {\r\n        const dayStr = format(day, 'yyyy-MM-dd');\r\n        runningBalance += daysInMonth[dayStr].dailyBalance;\r\n        daysInMonth[dayStr].runningBalance = runningBalance;\r\n        day = addDays(day, 1);\r\n      }\r\n      \r\n      setMonthData({\r\n        days: daysInMonth,\r\n        totalIncome: monthlyIncome,\r\n        totalExpenses: monthlyExpenses,\r\n        monthlyBalance: monthlyIncome - monthlyExpenses\r\n      });\r\n    } catch (error) {\r\n      console.error('Error updating month data', error);\r\n      // Initialize with empty data if there's an error\r\n      setMonthData({\r\n        days: {},\r\n        totalIncome: 0, \r\n        totalExpenses: 0,\r\n        monthlyBalance: 0\r\n      });\r\n    }\r\n  }, [entries, currentDate]);\r\n\r\n  const addEntry = (entry: Omit<FinancialEntry, 'id'>) => {\r\n    try {\r\n      const newEntry: FinancialEntry = {\r\n        ...entry,\r\n        id: Date.now().toString(),\r\n        date: entry.date instanceof Date ? entry.date : new Date(entry.date)\r\n      };\r\n      setEntries(prev => [...prev, newEntry]);\r\n    } catch (error) {\r\n      console.error('Error adding entry', error);\r\n    }\r\n  };\r\n\r\n  const deleteEntry = (id: string) => {\r\n    setEntries(prev => prev.filter(entry => entry.id !== id));\r\n  };\r\n\r\n  return {\r\n    monthData,\r\n    addEntry,\r\n    deleteEntry,\r\n    entries\r\n  };\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}